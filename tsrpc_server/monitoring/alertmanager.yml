# Alertmanager é…ç½®
# å‘Šè­¦è·¯ç”±å’Œé€šçŸ¥é…ç½®

global:
  resolve_timeout: 5m
  # Slack webhook URL (éœ€è¦é…ç½®)
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# å‘Šè­¦è·¯ç”±è§„åˆ™
route:
  receiver: 'default'
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s          # ç­‰å¾…10ç§’æ”¶é›†åŒä¸€ç»„çš„å‘Šè­¦
  group_interval: 10s      # åŒä¸€ç»„å‘Šè­¦çš„å‘é€é—´éš”
  repeat_interval: 12h     # é‡å¤å‘Šè­¦çš„é—´éš”

  # å­è·¯ç”±
  routes:
    # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m

    # è­¦å‘Šçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 30m

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:8080/alerts/webhook'

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    # Slack é€šçŸ¥
    slack_configs:
      - channel: '#alerts-critical'
        title: 'ğŸš¨ ä¸¥é‡å‘Šè­¦'
        text: |
          *å‘Šè­¦*: {{ .CommonAnnotations.summary }}
          *æè¿°*: {{ .CommonAnnotations.description }}
          *æœåŠ¡*: {{ .CommonLabels.service }}
          *æ—¶é—´*: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
        send_resolved: true

    # Email é€šçŸ¥ (éœ€è¦é…ç½® SMTP)
    email_configs:
      - to: 'ops-team@example.com'
        from: 'alertmanager@example.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'alertmanager@example.com'
        auth_identity: 'alertmanager@example.com'
        auth_password: 'your-password'
        headers:
          Subject: 'ğŸš¨ ä¸¥é‡å‘Šè­¦ - Coin Pusher Game'

    # Webhook é€šçŸ¥
    webhook_configs:
      - url: 'http://localhost:8080/alerts/critical'

  # è­¦å‘Šçº§åˆ«æ¥æ”¶å™¨
  - name: 'warning-alerts'
    slack_configs:
      - channel: '#alerts-warning'
        title: 'âš ï¸ è­¦å‘Šå‘Šè­¦'
        text: |
          *å‘Šè­¦*: {{ .CommonAnnotations.summary }}
          *æè¿°*: {{ .CommonAnnotations.description }}
          *æœåŠ¡*: {{ .CommonLabels.service }}
        send_resolved: true

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœåŠ¡ä¸‹çº¿ï¼ŒæŠ‘åˆ¶è¯¥æœåŠ¡çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.+'
    equal: ['job', 'instance']

  # å¦‚æœæœ‰ä¸¥é‡å‘Šè­¦ï¼ŒæŠ‘åˆ¶è­¦å‘Šçº§åˆ«å‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']
