# 管理后台权限设计文档

## 📋 角色权限说明

### 1. 角色定义

#### SuperAdmin (超级管理员)
- **用途**: 系统最高权限，通常分配给技术负责人或CEO
- **数量建议**: 1-2人
- **权限**: 所有功能的完整访问权限

#### Operator (运营人员) ⭐
- **用途**: 日常运营工作，活动策划，用户运营
- **数量建议**: 3-10人
- **核心权限**:
  - ✅ 查看和管理用户数据
  - ✅ 发送系统邮件（单发、群发）
  - ✅ 创建和管理活动
  - ✅ 修改游戏配置（经济参数、活动参数等）
  - ✅ 查看统计数据和日志
  - ❌ **不能**封禁用户
  - ❌ **不能**发放奖励
  - ❌ **不能**管理其他管理员

#### CustomerService (客服)
- **用途**: 处理玩家投诉，处理异常账号
- **数量建议**: 5-20人
- **核心权限**:
  - ✅ 查看用户详细信息
  - ✅ 封禁/解封用户
  - ✅ 发放补偿奖励
  - ✅ 发送单人邮件
  - ❌ **不能**群发邮件
  - ❌ **不能**修改配置
  - ❌ **不能**创建活动

#### Analyst (数据分析师)
- **用途**: 数据报表，用户分析
- **数量建议**: 1-5人
- **核心权限**:
  - ✅ 查看所有数据报表
  - ✅ 查看日志
  - ❌ **不能**进行任何修改操作

---

## 🔧 实施指南

### 第一步：创建运营账号

使用超级管理员账号登录后台，在"管理员管理"页面创建新账号：

```bash
用户名: operator_zhangsan
密码: [强密码]
角色: Operator (运营人员)
邮箱: zhangsan@company.com
```

### 第二步：权限验证

所有 Admin API 都会自动验证权限，代码位于：
```
src/server/gate/api/admin/*.ts
```

每个 API 都有权限检查：
```typescript
// 示例：发送邮件需要 SendMail 权限
if (!hasPermission(call, AdminPermission.SendMail)) {
    return { success: false, error: '权限不足' };
}
```

### 第三步：前端权限控制

前端根据用户角色显示/隐藏功能按钮：

```typescript
// 前端代码示例
{userRole === 'operator' && (
  <Button>创建活动</Button>
)}

{userRole === 'super_admin' && (
  <Button>管理员设置</Button>
)}
```

---

## 🔒 安全建议

### 1. 账号安全
- ✅ 使用强密码（建议启用密码复杂度验证）
- ✅ 定期更换密码（每90天）
- ✅ 启用2FA双因素认证（重要账号必须开启）
- ✅ 记录所有登录IP和时间
- ✅ 失败登录5次后自动锁定30分钟

### 2. 操作审计
- ✅ 所有敏感操作都会记录日志
- ✅ 包括：谁、什么时间、做了什么、结果如何
- ✅ 日志永久保存，用于审计和溯源

### 3. IP白名单（可选）
如果需要更高安全性，可以限制只有公司IP才能访问：
```typescript
const ALLOWED_IPS = ['192.168.1.0/24', '公司公网IP'];
```

---

## 📊 权限矩阵

| 功能模块 | SuperAdmin | Operator | CustomerService | Analyst |
|---------|------------|----------|-----------------|---------|
| 查看用户列表 | ✅ | ✅ | ✅ | ✅ |
| 查看用户详情 | ✅ | ✅ | ✅ | ✅ |
| 封禁用户 | ✅ | ❌ | ✅ | ❌ |
| 发放奖励 | ✅ | ❌ | ✅ | ❌ |
| 发送单人邮件 | ✅ | ✅ | ✅ | ❌ |
| 发送群发邮件 | ✅ | ✅ | ❌ | ❌ |
| 创建活动 | ✅ | ✅ | ❌ | ❌ |
| 编辑活动 | ✅ | ✅ | ❌ | ❌ |
| 查看配置 | ✅ | ✅ | ❌ | ✅ |
| 编辑配置 | ✅ | ✅ | ❌ | ❌ |
| 查看统计数据 | ✅ | ✅ | ❌ | ✅ |
| 查看日志 | ✅ | ✅ | ✅ | ✅ |
| 管理员管理 | ✅ | ❌ | ❌ | ❌ |
| 系统设置 | ✅ | ❌ | ❌ | ❌ |

---

## 🎯 快速配置运营权限

### 方案A：只允许运营人员登录

如果你希望**只有运营角色**才能访问后台：

1. **禁用默认超级管理员账号** (在数据库中设置 status='disabled')
2. **只创建 Operator 角色的账号**
3. **在登录接口添加角色白名单检查**

### 方案B：限制非运营人员的访问时间

只允许运营人员在工作时间（9:00-18:00）访问，其他时间只有超级管理员可以登录。

### 方案C：多级审批

运营人员的敏感操作（如发放大额奖励）需要超级管理员审批后才能生效。

---

## 💡 常见问题

### Q1: 如何创建第一个运营账号？
**A**: 使用默认的超级管理员账号 (admin/admin123) 登录后台，进入"管理员管理"页面创建。

### Q2: 运营人员能看到其他管理员的信息吗？
**A**: 不能。只有 SuperAdmin 才有 ManageAdmins 权限。

### Q3: 如果运营人员需要临时封禁用户怎么办？
**A**: 有两个方案：
1. 联系客服人员或超级管理员处理
2. 为该运营人员临时授予 BanUsers 权限（不推荐）

### Q4: 权限可以自定义吗？
**A**: 可以！在 AdminUser 的 `permissions` 字段中可以为单个用户授予额外权限，不受角色限制。

---

## 🚀 下一步

1. ✅ 登录管理后台
2. ✅ 使用 admin/admin123 登录
3. ✅ 创建运营人员账号
4. ✅ 测试运营人员权限
5. ✅ 禁用或修改默认管理员密码
6. ✅ 启用2FA双因素认证
