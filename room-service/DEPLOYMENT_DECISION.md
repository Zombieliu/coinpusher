# 🚀 部署决策速查表

## 快速决策

### 你需要回答的问题：

1. **是否面向中国用户？**
   - ✅ 是 → **必须部署中国/香港节点**（+$150/月）
   - ❌ 否 → 可跳过中国方案

2. **预计用户规模？**
   - < 1,000 → 单节点 MVP ($100/月)
   - 1,000-10,000 → 双节点部署 ($200/月) ⭐ 推荐
   - > 10,000 → 三节点全球 ($400/月)

3. **用户地域分布？**
   - 主要亚太 → 新加坡单节点
   - 全球均匀 → 多节点部署
   - 欧美为主 → 美西 + 欧洲

---

## 推荐配置对照表

| 场景 | 节点配置 | 月成本 | 覆盖率 | 适用 |
|------|----------|--------|--------|------|
| **MVP** | 新加坡 4C8G 10M | $100 | 60% | < 1K 用户 |
| **标准** ⭐ | 新加坡 + 美西 | $200 | 80% | 1K-10K 用户 |
| **完整** | 新加坡 + 美西 + 欧洲 | $400 | 95% | > 10K 用户 |
| **中国** 🇨🇳 | + 香港 CN2 | +$150 | +15% | 中国市场 |

---

## 关键测试数据

### 网络场景性能对比

```
场景              消息接收率    用户体验      结论
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
移动4G            143%         ⭐⭐⭐⭐⭐   最佳性能
跨地域(100ms)      85%         ⭐⭐⭐⭐     优秀
跨太平洋(200ms)    74%         ⭐⭐⭐       良好
电信5M             32%         ⭐⭐         可接受
GFW翻墙            6%          ❌          不可用
弱网(2M)           7%          ❌          不可用
```

### 带宽影响分析

```
带宽 → 接收率 → 评级
━━━━━━━━━━━━━━━━━━━
20M  → 143%  → ⭐⭐⭐⭐⭐ 最佳
10M  → 85%   → ⭐⭐⭐⭐   优秀  ← 推荐
5M   → 32%   → ⭐⭐     可接受
2M   → 7%    → ❌      不可用
```

---

## 核心结论（3 点）

### 1. GFW 是中国市场的致命瓶颈 ⚠️
```
中国用户访问海外服务器：接收率 6% = 94% 消息丢失 = 完全不可玩

解决方案：
✅ 香港 CN2 节点（无需备案，$150/月）
✅ Cloudflare Argo 加速
❌ 不部署 = 失去中国市场
```

### 2. 带宽 > 延迟 📊
```
20M + 40ms  > 5M + 20ms   (143% vs 32%)
10M + 200ms > 5M + 20ms   (74% vs 32%)

教训：优先保证带宽 10Mbps+，延迟 200ms 内都可接受
```

### 3. 移动端表现完美 ✅
```
4G/5G 网络：143% 接收率 = 服务器推送充分 = 最佳体验

结论：手机用户完全不用担心性能问题
```

---

## 立即执行（本周）

### 方案 A：国际市场（无中国）
```bash
# 部署新加坡 + 美西双节点
总成本：$200/月
覆盖：全球 70-80% 用户优秀体验
```

### 方案 B：包含中国市场 ⭐ 推荐
```bash
# 部署新加坡 + 美西 + 香港 CN2
总成本：$350/月
覆盖：全球 85-90% 用户优秀体验
```

---

## 性能优化（下周开始）

### 优先级 1：减少 80% 带宽占用 ⚠️
```rust
// 1. MessagePack 压缩（减少 60% 数据）
// 2. 增量更新（只发送变化，减少 80%）
// 3. 自适应推送（弱网降频）

预期效果：
- 5Mbps 从 32% → 80% 接收率
- 2Mbps 从 7% → 40% 接收率（可玩）
```

### 优先级 2：智能路由 🌐
```javascript
// 客户端自动选择最快节点
const fastest = await findFastestNode([
  'sg.yourservice.com',  // 新加坡
  'us.yourservice.com',  // 美国
  'hk.yourservice.com'   // 香港
]);
```

---

## 成本预算

### 初期（3 个月）
```
新加坡节点    $100/月 × 3 = $300
美西节点      $100/月 × 3 = $300
香港CN2       $150/月 × 3 = $450
CDN/加速      $50/月 × 3  = $150
━━━━━━━━━━━━━━━━━━━━━━━━━━
总计：$1,200 (¥8,600)
```

### 成熟期（年成本）
```
三节点全球    $400/月 × 12 = $4,800
香港CN2       $150/月 × 12 = $1,800
CDN/监控      $100/月 × 12 = $1,200
━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计：$7,800/年 (¥56,000/年)
```

---

## 决策流程图

```
开始
 ↓
是否包含中国用户？
 ├─ 是 → 必须香港CN2节点 (+$150/月)
 └─ 否 → 跳过
 ↓
预计用户规模？
 ├─ < 1K  → 单节点MVP ($100/月)
 ├─ 1-10K → 双节点 ($200/月) ⭐
 └─ > 10K → 三节点 ($400/月)
 ↓
部署完成
 ↓
Week 2: 实现压缩 + 增量更新（减少 80% 带宽）
 ↓
Week 4: 添加监控告警
 ↓
持续优化
```

---

## 快速参考

### 推荐云服务商

**亚太（新加坡）：**
- AWS Singapore: t3.xlarge (4C8G) + 10Mbps ~$110/月
- DigitalOcean: CPU Optimized ~$80/月
- 阿里云国际：4C8G ~$90/月

**美洲（美西）：**
- AWS Oregon: t3.xlarge ~$100/月
- DigitalOcean SF: ~$80/月

**中国（香港CN2）：**
- BandwagonHost CN2 GIA: ~$150/月
- Vultr 香港 + CN2: ~$120/月
- 腾讯云轻量 香港: ~¥300/月

### 监控指标

```yaml
健康标准:
  消息接收率: > 70%    # 低于则降级
  P95 延迟: < 100ms    # 超过则告警
  错误率: < 1%         # 超过则告警
  带宽使用: < 80%      # 超过则扩容
```

---

**最后更新：** 2025-12-01
**基于测试：** GLOBAL_WEB3_TEST_REPORT.md
