# ğŸ› ï¸ æ€§èƒ½æµ‹è¯•å·¥å…·æ€»è§ˆ

## å¿«é€Ÿå‚è€ƒ

### é—®é¢˜ï¼š502 é”™è¯¯ï¼Ÿ

```bash
# ä¸€é”®æ¸…ç†å’Œé‡ç½®
./cleanup-and-reset.sh
```

### é—®é¢˜ï¼šæƒ³æµ‹è¯•æœåŠ¡å™¨é…ç½®æ€§èƒ½ï¼Ÿ

```bash
# æµ‹è¯• CPU å’Œå†…å­˜å½±å“ï¼ˆä¸è€ƒè™‘ç½‘ç»œï¼‰
./perf-test-cloud-sim.sh all
```

### é—®é¢˜ï¼šæƒ³æµ‹è¯•çœŸå®ç½‘ç»œæ¡ä»¶ï¼Ÿ

```bash
# æµ‹è¯•å¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ…å½±å“
./perf-test-with-network.sh --preset china-telecom-5m
```

---

## ğŸ“š å·¥å…·åˆ—è¡¨

| å·¥å…· | æµ‹è¯•å†…å®¹ | ç”¨é€” |
|------|----------|------|
| **perf-test-cloud-sim.sh** | CPU + å†…å­˜ | è¯„ä¼°ä¸åŒæœåŠ¡å™¨é…ç½® |
| **perf-test-with-network.sh** | å¸¦å®½ + å»¶è¿Ÿ + ä¸¢åŒ… | è¯„ä¼°ç½‘ç»œæ¡ä»¶å½±å“ |
| **stress-test.sh** | åŸºç¡€å‹åŠ›æµ‹è¯• | å¿«é€ŸéªŒè¯æœåŠ¡ç¨³å®šæ€§ |
| **analyze-perf.py** | ç»“æœåˆ†æ | ç”ŸæˆæŠ¥å‘Šå’Œå›¾è¡¨ |
| **cleanup-and-reset.sh** | ç¯å¢ƒæ¸…ç† | è§£å†³ 502ã€ç«¯å£å ç”¨ |
| **fix-line-endings.sh** | ä¿®å¤æ¢è¡Œç¬¦ | è§£å†³è„šæœ¬æ‰§è¡Œé”™è¯¯ |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: é€‰æ‹©äº‘æœåŠ¡å™¨é…ç½®

**ç›®æ ‡ï¼š** 2C4Gã€4C8Gã€8C16G é€‰å“ªä¸ªï¼Ÿ

```bash
# æµ‹è¯•æ‰€æœ‰é…ç½®
./perf-test-cloud-sim.sh all

# æŸ¥çœ‹æŠ¥å‘Š
python3 analyze-perf.py
```

**æŸ¥çœ‹æŒ‡æ ‡ï¼š**
- P95 å»¶è¿Ÿ < 10ms = ä¼˜ç§€
- P95 å»¶è¿Ÿ 10-50ms = å¯ç”¨
- P95 å»¶è¿Ÿ > 50ms = éœ€å‡çº§

### åœºæ™¯ 2: è¯„ä¼°å¸¦å®½éœ€æ±‚

**ç›®æ ‡ï¼š** éœ€è¦è´­ä¹°å¤šå°‘å¸¦å®½ï¼Ÿ

```bash
# æµ‹è¯•ä¸åŒå¸¦å®½
./perf-test-with-network.sh --preset china-telecom-1m
./perf-test-with-network.sh --preset china-telecom-5m
./perf-test-with-network.sh --preset china-telecom-10m
```

**æŸ¥çœ‹æŒ‡æ ‡ï¼š**
- æ¶ˆæ¯é€Ÿç‡ï¼ˆmsg/sï¼‰
- è¶…æ—¶ç‡ï¼ˆåº” < 1%ï¼‰
- ååé‡æ˜¯å¦æ»¡è¶³éœ€æ±‚

### åœºæ™¯ 3: æµ‹è¯•å¼±ç½‘ç¨³å®šæ€§

**ç›®æ ‡ï¼š** 4G ç”¨æˆ·èƒ½å¦æ­£å¸¸æ¸¸æˆï¼Ÿ

```bash
# æ¨¡æ‹Ÿ 4G ç½‘ç»œ
./perf-test-with-network.sh --preset mobile-4g

# æ¨¡æ‹Ÿå¼±ç½‘
./perf-test-with-network.sh --preset poor-network
```

**æŸ¥çœ‹æŒ‡æ ‡ï¼š**
- è¶…æ—¶ç‡ï¼ˆåº” < 5%ï¼‰
- é”™è¯¯ç‡ï¼ˆåº” < 1%ï¼‰
- å¿«ç…§é¢‘ç‡ï¼ˆåº” > 15Hzï¼‰

### åœºæ™¯ 4: å‹åŠ›æµ‹è¯•æ‰¾æé™

**ç›®æ ‡ï¼š** æœåŠ¡å™¨èƒ½æ‰¿è½½å¤šå°‘æˆ¿é—´ï¼Ÿ

```bash
# ç¼–è¾‘è„šæœ¬ï¼Œé€æ­¥å¢åŠ è´Ÿè½½
# perf-test-cloud-sim.sh ä¸­ä¿®æ”¹ï¼š
# ROOM_COUNT=200
# COINS_PER_ROOM=150

./perf-test-cloud-sim.sh 4c8g
```

**æŸ¥çœ‹æŒ‡æ ‡ï¼š**
- CPU ä½¿ç”¨ç‡ï¼ˆåº” < 80%ï¼‰
- å†…å­˜ä½¿ç”¨ç‡ï¼ˆåº” < 80%ï¼‰
- å»¶è¿Ÿæ˜¯å¦æ˜¾è‘—å¢åŠ 

### åœºæ™¯ 5: è§£å†³é—®é¢˜

**é—®é¢˜ï¼š** æµ‹è¯•å¤±è´¥ã€502 é”™è¯¯ã€ç«¯å£å ç”¨

```bash
# æ¸…ç†æ‰€æœ‰èµ„æº
./cleanup-and-reset.sh

# é‡æ–°æµ‹è¯•
./perf-test-cloud-sim.sh 4c8g
```

---

## ğŸ“Š å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤ 1: ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿ Docker è¿è¡Œ
docker --version

# æ¸…ç†æ—§ç¯å¢ƒ
./cleanup-and-reset.sh
```

### æ­¥éª¤ 2: åŸºç¡€æ€§èƒ½æµ‹è¯•
```bash
# æµ‹è¯• CPU/å†…å­˜å½±å“
./perf-test-cloud-sim.sh all
```

### æ­¥éª¤ 3: ç½‘ç»œæ€§èƒ½æµ‹è¯•
```bash
# æµ‹è¯•å¸¸è§ç½‘ç»œåœºæ™¯
./perf-test-with-network.sh --preset china-telecom-5m
./perf-test-with-network.sh --preset mobile-4g
```

### æ­¥éª¤ 4: åˆ†æç»“æœ
```bash
# æ–‡æœ¬æŠ¥å‘Š
python3 analyze-perf.py

# HTML æŠ¥å‘Š
python3 analyze-perf.py --html
open perf-report.html

# æ€§èƒ½å›¾è¡¨ï¼ˆéœ€è¦ matplotlibï¼‰
pip3 install matplotlib
python3 analyze-perf.py --plot
open perf-charts.png
```

### æ­¥éª¤ 5: å†³ç­–

æ ¹æ®æµ‹è¯•ç»“æœï¼š
- âœ… **P95 < 10ms** â†’ å¯ä»¥ä¸Šçº¿
- âš ï¸ **P95 10-50ms** â†’ å¯ç”¨ï¼Œå»ºè®®é¢„ç•™ä½™é‡
- âŒ **P95 > 50ms** â†’ éœ€è¦ä¼˜åŒ–æˆ–å‡çº§é…ç½®

---

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### æµ‹è¯•ç»´åº¦

| ç»´åº¦ | è¯´æ˜ | å·¥å…· |
|------|------|------|
| **è®¡ç®—æ€§èƒ½** | CPU å¤„ç†èƒ½åŠ› | perf-test-cloud-sim.sh |
| **å†…å­˜å®¹é‡** | å†…å­˜ä½¿ç”¨å’Œé™åˆ¶ | perf-test-cloud-sim.sh |
| **ç½‘ç»œå¸¦å®½** | æ•°æ®ä¼ è¾“é€Ÿç‡ | perf-test-with-network.sh |
| **ç½‘ç»œå»¶è¿Ÿ** | å¾€è¿”æ—¶é—´ (RTT) | perf-test-with-network.sh |
| **ç½‘ç»œç¨³å®š** | ä¸¢åŒ…ç‡ | perf-test-with-network.sh |

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | å«ä¹‰ | ä¼˜ç§€æ ‡å‡† |
|------|------|----------|
| **P50 å»¶è¿Ÿ** | 50% è¯·æ±‚çš„å»¶è¿Ÿ | < 5ms |
| **P95 å»¶è¿Ÿ** | 95% è¯·æ±‚çš„å»¶è¿Ÿ | < 10ms |
| **P99 å»¶è¿Ÿ** | 99% è¯·æ±‚çš„å»¶è¿Ÿ | < 20ms |
| **ååé‡** | æ¯ç§’å¤„ç†æ¶ˆæ¯æ•° | > 300/s |
| **é”™è¯¯ç‡** | å¤±è´¥è¯·æ±‚ç™¾åˆ†æ¯” | < 0.1% |
| **è¶…æ—¶ç‡** | è¶…æ—¶è¯·æ±‚ç™¾åˆ†æ¯” | < 0.5% |
| **CPU ä½¿ç”¨** | CPU å ç”¨ç™¾åˆ†æ¯” | < 70% |
| **å†…å­˜ä½¿ç”¨** | å†…å­˜å ç”¨ç™¾åˆ†æ¯” | < 70% |

---

## ğŸš€ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æµ‹è¯•å‚æ•°

ç¼–è¾‘è„šæœ¬ä¿®æ”¹ï¼š
- **æˆ¿é—´æ•°é‡** (ROOM_COUNT)
- **æ¯æˆ¿é—´ç¡¬å¸æ•°** (COINS_PER_ROOM)
- **æŠ•å¸é—´éš”** (DROP_INTERVAL)

### Docker æ‰‹åŠ¨è°ƒè¯•

```bash
# å¯åŠ¨å®¹å™¨
docker run -it --rm \
    --cpus=4.0 \
    --memory=8g \
    --cap-add=NET_ADMIN \
    -p 9000:9000 \
    room-service:latest

# è¿›å…¥å®¹å™¨
docker exec -it <container-id> bash

# æŸ¥çœ‹ç½‘ç»œé…ç½®
tc qdisc show dev eth0

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep room-service
```

### çœŸå®äº‘æœåŠ¡å™¨æµ‹è¯•

```bash
# SSH åˆ°äº‘æœåŠ¡å™¨
ssh user@your-server

# ä¸Šä¼ æµ‹è¯•è„šæœ¬
scp stress-test.sh user@your-server:~/

# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
./stress-test.sh
```

---

## ğŸ“– æ–‡æ¡£ç´¢å¼•

- **QUICKSTART_PERF_TEST.md** - 1åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
- **PERF_TESTING.md** - CPU/å†…å­˜æµ‹è¯•è¯¦ç»†æŒ‡å—
- **NETWORK_TESTING.md** - ç½‘ç»œæµ‹è¯•è¯¦ç»†æŒ‡å—ï¼ˆå«å¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ…ï¼‰
- **TEST_TOOLS_SUMMARY.md** - æœ¬æ–‡æ¡£ï¼Œå·¥å…·æ€»è§ˆ
- **TROUBLESHOOTING.md** - æ•…éšœæ’æŸ¥ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰

---

## âœ… æ£€æŸ¥æ¸…å•

å¼€å§‹æµ‹è¯•å‰ï¼š
- [ ] Docker å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] ç«¯å£ 9000-9020 æœªè¢«å ç”¨
- [ ] Python 3.6+ å·²å®‰è£…
- [ ] è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼ˆchmod +xï¼‰

æµ‹è¯•å®Œæˆåï¼š
- [ ] æŸ¥çœ‹æ€§èƒ½æŠ¥å‘Š
- [ ] å¯¹æ¯”ä¸åŒé…ç½®ç»“æœ
- [ ] è®°å½•åŸºçº¿æ•°æ®
- [ ] åœ¨çœŸå®ç¯å¢ƒéªŒè¯

---

## ğŸ‰ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æ¸…ç†ç¯å¢ƒ
./cleanup-and-reset.sh

# CPU/å†…å­˜æµ‹è¯•
./perf-test-cloud-sim.sh all

# ç½‘ç»œæµ‹è¯•
./perf-test-with-network.sh --preset china-telecom-5m

# ç”ŸæˆæŠ¥å‘Š
python3 analyze-perf.py --html

# æŸ¥çœ‹ç»“æœ
open perf-report.html
```

---

**ç°åœ¨ä½ å·²ç»æŒæ¡äº†å®Œæ•´çš„æ€§èƒ½æµ‹è¯•å·¥å…·é“¾ï¼** ğŸ“

æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹å¯¹åº”çš„è¯¦ç»†æ–‡æ¡£æˆ–è¿è¡Œ `./cleanup-and-reset.sh` é‡ç½®ç¯å¢ƒã€‚
