version: '3.8'

# ğŸŒ å¸¦ç½‘ç»œæ¨¡æ‹Ÿçš„æ€§èƒ½æµ‹è¯•
# æ¨¡æ‹ŸçœŸå®äº‘æœåŠ¡å™¨çš„ç½‘ç»œæ¡ä»¶ï¼šå¸¦å®½é™åˆ¶ã€å»¶è¿Ÿã€ä¸¢åŒ…ç­‰

services:
  # 4æ ¸8G + 5Mbpså¸¦å®½é™åˆ¶ï¼ˆè…¾è®¯äº‘æ ‡å‡†ï¼‰
  room-service-4c8g-5mbps:
    build: .
    container_name: room-service-4c8g-5mbps
    ports:
      - "9011:9000"
    environment:
      - RUST_LOG=info
      - ROOM_SERVICE_ADDR=0.0.0.0:9000
      - TICK_RATE=30
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '4.0'
          memory: 8G
    cap_add:
      - NET_ADMIN  # éœ€è¦ç½‘ç»œç®¡ç†æƒé™æ¥è®¾ç½®å¸¦å®½é™åˆ¶
    networks:
      - net-5mbps
    profiles:
      - network-test

  # ç½‘ç»œæ¨¡æ‹Ÿå™¨å®¹å™¨
  # ç”¨äºåœ¨æµ‹è¯•å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ¨¡æ‹Ÿç½‘ç»œæ¡ä»¶
  network-simulator:
    image: gaiadocker/iproute2:latest
    container_name: network-simulator
    privileged: true
    cap_add:
      - NET_ADMIN
    networks:
      - net-5mbps
    command: sleep infinity
    profiles:
      - network-test

networks:
  net-5mbps:
    driver: bridge
    driver_opts:
      com.docker.network.driver.mtu: 1500
