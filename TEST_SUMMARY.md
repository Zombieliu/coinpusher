# ğŸ§ª æµ‹è¯•å¿«é€ŸæŒ‡å—

## æµ‹è¯•è„šæœ¬ä¸€è§ˆ

| è„šæœ¬ | ç”¨é€” | è¿è¡Œæ—¶é—´ | ä½•æ—¶ä½¿ç”¨ |
|-----|------|---------|---------|
| `./test-quick.sh` | Rust å•å…ƒæµ‹è¯• | ~5ç§’ | ä»£ç ä¿®æ”¹åå¿«é€ŸéªŒè¯ |
| `./test-e2e.sh` | å®Œæ•´ç«¯åˆ°ç«¯æµ‹è¯• | ~30ç§’ | æäº¤å‰å®Œæ•´éªŒè¯ |
| `cd room-service && cargo bench` | æ€§èƒ½åŸºå‡†æµ‹è¯• | ~2åˆ†é’Ÿ | æ€§èƒ½ä¼˜åŒ–åå¯¹æ¯” |
| `cd room-service && ./stress-test.sh` | å‹åŠ›æµ‹è¯• | ~1åˆ†é’Ÿ | éªŒè¯ç³»ç»Ÿç¨³å®šæ€§ |

---

## å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å¿«é€ŸéªŒè¯ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰

```bash
chmod +x test-quick.sh
./test-quick.sh
```

**è¾“å‡ºï¼š**
```
ğŸš€ å¿«é€Ÿæµ‹è¯•

ğŸ§ª è¿è¡Œ Rust å•å…ƒæµ‹è¯•...
âœ… æµ‹è¯•é€šè¿‡ (16/16)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ å¿«é€Ÿæµ‹è¯•å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

### 2ï¸âƒ£ å®Œæ•´ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆæäº¤å‰å¿…åšï¼‰

```bash
chmod +x test-e2e.sh
./test-e2e.sh
```

**æµ‹è¯•æµç¨‹ï¼š**
1. âœ… æ£€æŸ¥ä¾èµ–ï¼ˆRustã€Node.jsï¼‰
2. ğŸ”¨ ç¼–è¯‘ Rust Room Service
3. ğŸ¯ å¯åŠ¨ Rust æœåŠ¡ï¼ˆåå°ï¼‰
4. ğŸ§ª è¿è¡Œ Rust å•å…ƒæµ‹è¯• (16ä¸ª)
5. ğŸ§ª è¿è¡Œ Node é›†æˆæµ‹è¯• (8ä¸ª)
6. ğŸ§¹ è‡ªåŠ¨æ¸…ç†è¿›ç¨‹

**è¾“å‡ºï¼š**
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æµ‹è¯•ç»“æœï¼š
  âœ… Rust å•å…ƒæµ‹è¯•: 16/16 é€šè¿‡
  âœ… Node é›†æˆæµ‹è¯•: é€šè¿‡
  âœ… TCP é€šä¿¡: æ­£å¸¸
  âœ… ç‰©ç†æ¨¡æ‹Ÿ: æ­£å¸¸
```

---

### 3ï¸âƒ£ æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆä¼˜åŒ–åå¯¹æ¯”ï¼‰

```bash
cd room-service
cargo bench
```

**æµ‹è¯•åœºæ™¯ï¼š**
- å•ç¡¬å¸ç‰©ç†æ­¥è¿›
- å¤šç¡¬å¸ç‰©ç†æ­¥è¿› (10/50/100/200)
- æˆ¿é—´åˆ›å»º/é”€æ¯
- JSON åºåˆ—åŒ–/ååºåˆ—åŒ–

**é¢„æœŸæ€§èƒ½ï¼š**
```
physics_step_1_coin          3.0 ms   â† å•ç¡¬å¸
physics_step_50_coins        5.0 ms   â† 50ç¡¬å¸
physics_step_100_coins       8.0 ms   â† 100ç¡¬å¸
physics_step_200_coins      15.0 ms   â† 200ç¡¬å¸
```

**æŸ¥çœ‹ HTML æŠ¥å‘Šï¼š**
```bash
open target/criterion/report/index.html
```

**å¯¹æ¯”æ€§èƒ½ï¼š**

Criterion ä¼šè‡ªåŠ¨å¯¹æ¯”ä¹‹å‰çš„è¿è¡Œç»“æœï¼š

```
physics_step_100_coins
                        time:   [7.8 ms 8.1 ms 8.5 ms]
                        change: [-5.2% -3.1% -1.0%] (p = 0.01)
                        Performance has improved. ğŸ‰
```

---

### 4ï¸âƒ£ å‹åŠ›æµ‹è¯•ï¼ˆéªŒè¯ç¨³å®šæ€§ï¼‰

```bash
cd room-service
./stress-test.sh
```

**æµ‹è¯•é…ç½®ï¼š**
- 5 ä¸ªæˆ¿é—´å¹¶å‘
- æ¯æˆ¿é—´ 100 ç¡¬å¸
- æ€»è®¡ 500 ç¡¬å¸

**é¢„æœŸè¾“å‡ºï¼š**
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å‹åŠ›æµ‹è¯•ç»Ÿè®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  è¿è¡Œæ—¶é—´: 65.23s
  å‘é€æ¶ˆæ¯: 505
  æ¥æ”¶æ¶ˆæ¯: 1,523
  å¿«ç…§æ•°é‡: 1,520
  é”™è¯¯æ¬¡æ•°: 0
  æ¶ˆæ¯é€Ÿç‡: 7.7 msg/s

  æœ€è¿‘å¿«ç…§ç¡¬å¸æ•°: 98 (å¹³å‡)
  å¿«ç…§é¢‘ç‡: 29.8 Hz
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**éªŒè¯æŒ‡æ ‡ï¼š**
- âœ… CPU < 30%
- âœ… å†…å­˜ < 200MB
- âœ… å¿«ç…§é¢‘ç‡ ~30Hz
- âœ… æ— é”™è¯¯

---

## æµ‹è¯•è¦†ç›–è¯¦æƒ…

### Rust å•å…ƒæµ‹è¯• (16ä¸ª)

**ç‰©ç†å¼•æ“æµ‹è¯• (8ä¸ª)ï¼š**
- âœ… test_physics_world_creation - ç‰©ç†ä¸–ç•Œåˆå§‹åŒ–
- âœ… test_spawn_coin - ç”Ÿæˆç¡¬å¸
- âœ… test_multiple_coins - å¤šç¡¬å¸ç®¡ç†
- âœ… test_physics_step - é‡åŠ›æ¨¡æ‹Ÿ
- âœ… test_push_platform_movement - æ¨æ¿è¿åŠ¨
- âœ… test_push_platform_boundary - è¾¹ç•Œçº¦æŸ
- âœ… test_coin_removal - ç¡¬å¸ç§»é™¤
- âœ… test_coin_collection - ç¡¬å¸æ”¶é›†

**æˆ¿é—´ç®¡ç†æµ‹è¯• (8ä¸ª)ï¼š**
- âœ… test_room_manager_creation - ç®¡ç†å™¨åˆå§‹åŒ–
- âœ… test_create_room - åˆ›å»ºæˆ¿é—´
- âœ… test_destroy_room - é”€æ¯æˆ¿é—´
- âœ… test_multiple_rooms - å¤šæˆ¿é—´ç®¡ç†
- âœ… test_player_join - ç©å®¶åŠ å…¥
- âœ… test_drop_coin - æŠ•å¸æµç¨‹
- âœ… test_tick_generates_snapshots - å¿«ç…§ç”Ÿæˆ
- âœ… test_tick_increments - Tick è®¡æ•°

### Node é›†æˆæµ‹è¯• (8ä¸ª)

- âœ… TCP è¿æ¥å»ºç«‹
- âœ… åˆ›å»ºæˆ¿é—´
- âœ… ç©å®¶åŠ å…¥/ç¦»å¼€
- âœ… æŠ•å¸åŠŸèƒ½
- âœ… å¿«ç…§æ¥æ”¶
- âœ… å¤šç¡¬å¸æµ‹è¯•
- âœ… æˆ¿é—´é”€æ¯

### æ€§èƒ½åŸºå‡†æµ‹è¯• (7ä¸ª)

- physics_step_1_coin
- physics_step_multiple_coins (4ç»„: 10/50/100/200)
- collect_coin_states (4ç»„)
- room_create_destroy
- room_tick_with_coins (3ç»„: 10/50/100)
- json_serialize_snapshot (4ç»„)
- json_deserialize_drop_coin

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼štest-e2e.sh æ— æ³•è¿è¡Œ

**é”™è¯¯ï¼š**
```
bad interpreter: /bin/bash^M
```

**è§£å†³ï¼š**
```bash
sed -i '' 's/\r$//' test-e2e.sh
chmod +x test-e2e.sh
```

### é—®é¢˜ï¼šNode é›†æˆæµ‹è¯•è¿æ¥å¤±è´¥

**é”™è¯¯ï¼š**
```
ECONNREFUSED 127.0.0.1:9000
```

**è§£å†³ï¼š**
```bash
cd room-service
cargo run --release
```

### é—®é¢˜ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•å¤±è´¥

**é”™è¯¯ï¼š**
```
error: no library targets found in package
```

**è§£å†³ï¼š**

æ£€æŸ¥ `room-service/src/lib.rs` æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼š

```bash
cd room-service
echo 'pub mod net;
pub mod protocol;
pub mod room;' > src/lib.rs
```

---

## CI/CD é›†æˆ

### GitHub Actions

```yaml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'

      - name: Run E2E Tests
        run: ./test-e2e.sh

      - name: Run Benchmarks
        run: cd room-service && cargo bench --no-fail-fast
```

---

## å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
# 1. ä¿®æ”¹ä»£ç 
vim room-service/src/room/physics.rs

# 2. å¿«é€ŸéªŒè¯
./test-quick.sh

# 3. ç»§ç»­å¼€å‘...
```

### æäº¤å‰æ£€æŸ¥

```bash
# 1. å®Œæ•´æµ‹è¯•
./test-e2e.sh

# 2. æ€§èƒ½å›å½’æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
cd room-service && cargo bench

# 3. ä»£ç æ ¼å¼åŒ–
cd room-service && cargo fmt

# 4. æäº¤
git add .
git commit -m "feat: add xxx feature"
```

### æ€§èƒ½ä¼˜åŒ–å

```bash
# 1. è¿è¡ŒåŸºå‡†æµ‹è¯•
cd room-service
cargo bench

# 2. æŸ¥çœ‹å¯¹æ¯”æŠ¥å‘Š
open target/criterion/report/index.html

# 3. å‹åŠ›æµ‹è¯•éªŒè¯
./stress-test.sh
```

---

## æ€§èƒ½ç›®æ ‡

### å½“å‰æ€§èƒ½ï¼ˆ2025-12-01ï¼‰

| åœºæ™¯ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|-----|------|------|------|
| 50ç¡¬å¸ç‰©ç†Tick | < 6ms | ~5ms | âœ… |
| 100ç¡¬å¸ç‰©ç†Tick | < 10ms | ~8ms | âœ… |
| 200ç¡¬å¸ç‰©ç†Tick | < 20ms | ~15ms | âœ… |
| å¿«ç…§åºåˆ—åŒ–100å¸ | < 150Âµs | ~120Âµs | âœ… |
| æˆ¿é—´åˆ›å»º/é”€æ¯ | < 100Âµs | ~80Âµs | âœ… |
| CPUå ç”¨500å¸ | < 30% | ~25% | âœ… |
| å†…å­˜å ç”¨500å¸ | < 200MB | ~150MB | âœ… |

### æ€§èƒ½å¯¹æ¯”ï¼šNode WASM vs Rust Native

| æŒ‡æ ‡ | Node + WASM | Rust Native | æå‡ |
|-----|-------------|-------------|------|
| ç‰©ç†Tickå»¶è¿Ÿ | 8-12ms | 3-5ms | **2-3x** |
| CPUå ç”¨ | 12% | 5% | **2.4x** |
| GCåœé¡¿ | 5-10ms | 0ms | **âˆ** |
| å†…å­˜å ç”¨ | 120MB | 40MB | **3x** |

---

**æŸ¥çœ‹è¯¦ç»†æµ‹è¯•æ–‡æ¡£**: `cat TESTING.md`

**æœ€åæ›´æ–°**: 2025-12-01
